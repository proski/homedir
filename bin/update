#! /bin/sh

# Update all sources in $HOME/src

if test "$#" = 0; then
  DIRS="$HOME/src/*/ $HOME/src/*/*/"
else
  DIRS="$@"
fi

trap 'echo Terminated; exit' INT
for d in $DIRS; do
  test -d $d || continue
  cd $d || continue
  if test -d CVS; then
    cmd="cvs -z3 -q update -P -d"
  elif test -d .bzr; then
    cmd="bzr pull"
  elif test -d .svn; then
    cmd="svn update"
  elif test -d .git && test -n "`git remote`" && stg series >/dev/null 2>&1; then
    cmd="git fetch --all --prune; stg pull"
  elif test -d .git && test -n "`git remote`"; then
    cmd="git fetch --all --prune; git pull"
  elif test -d .hg; then
    cmd="hg pull -u"
  else
    continue
  fi
  echo "updating $d" >&2
  eval $cmd
done
